!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return o(this,n)}}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{COhe:function(t,r,o){"use strict";o.r(r),o.d(r,"TestAndAssociateDeviceModule",function(){return ce});var c,s,l,f=o("PCNd"),d=o("tyNb"),b=o("3Pt+"),m=o("Pj3g"),v=o("xlym"),p=o("2Vo4"),g=o("EY2u"),h=o("LRne"),y=o("1G5W"),I=o("nYR2"),O=o("vkgz"),z=o("eIep"),T=o("lJxs"),C=o("pLZG"),j=o("fXoL"),D=o("ILvI"),A=o("o5fV"),k=o("dEAy"),S=((l=function(){function e(t){a(this,e),this.modal=t,this.modal.updateConfig({nzWrapClassName:"vertical-center-modal",nzMaskClosable:!0,nzAutofocus:null,nzOkType:"primary",nzOkText:"Assign",nzClosable:!1})}return u(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||l)(j.Ob(k.c))},l.\u0275cmp=j.Ib({type:l,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},styles:[""],changeDetection:0}),l),w=((s=function e(){a(this,e)}).\u0275mod=j.Mb({type:s}),s.\u0275inj=j.Lb({factory:function(e){return new(e||s)}}),s),_=((c=function(e){n(r,e);var t=i(r);function r(){return a(this,r),t.call(this)}return u(r,[{key:"getMeasurements",value:function(e){return this.getItems({order_by:null,limit:10,offset:0,devices:e},D.q).pipe(Object(T.a)(function(e){return e}))}},{key:"getDeviceInfo",value:function(e,t,n){return this.getItems({device_id:e,device_type:n,serial_number:t,assigned_to_patient:!1},D.f,{skipInterceptor:!0}).pipe(Object(T.a)(function(e){return e.items[0]}))}},{key:"associateDevice",value:function(e,t){return this.http.put(Object(D.u)(e),{device:t})}},{key:"openConfirmationModal",value:function(){return this.openActionConfirmationModal("Are you sure to assign selected device to this order? This action could not be reverted.",S)}}]),r}(A.a)).\u0275fac=function(e){return new(e||c)},c.\u0275prov=j.Kb({token:c,factory:c.\u0275fac,providedIn:w}),c),L=o("LEIr"),x=o("lhsU"),U=o("ofXK"),$=o("5vDB"),P=o("OzZK"),M=o("RwU8"),R=o("C2AL"),F=o("FwiY"),H=o("1ReC"),E=o("ocnv"),q=o("B+r4"),N=o("PTRe"),G=o("ZyQt"),J=o("rMZv");function W(e,t){1&e&&(j.Ub(0,"nz-tag",19),j.Pb(1,"i",20),j.Ub(2,"span"),j.Hc(3,"Device not found"),j.Tb(),j.Tb())}function V(e,t){1&e&&(j.Ub(0,"nz-tag",21),j.Pb(1,"i",22),j.Ub(2,"span"),j.Hc(3,"Device found"),j.Tb(),j.Tb())}function Y(e,t){if(1&e&&(j.Ub(0,"div",16),j.Fc(1,W,4,0,"nz-tag",17),j.Fc(2,V,4,0,"nz-tag",18),j.Tb()),2&e){var n=j.ec(2);j.Ab(1),j.mc("ngIf",!n.deviceIsFound),j.Ab(1),j.mc("ngIf",n.deviceIsFound)}}function Z(e,t){if(1&e){var n=j.Vb();j.Ub(0,"section"),j.Pb(1,"nz-divider",8),j.Ub(2,"form",9),j.Ub(3,"nz-form-item"),j.Ub(4,"nz-form-label",10),j.Hc(5,"Device ID"),j.Tb(),j.Ub(6,"nz-form-control",11),j.Pb(7,"input",12),j.Tb(),j.Tb(),j.Ub(8,"nz-form-item"),j.Ub(9,"nz-form-label",10),j.Hc(10,"Device serial number"),j.Tb(),j.Ub(11,"nz-form-control",11),j.Pb(12,"input",13),j.Tb(),j.Tb(),j.Ub(13,"nz-form-item"),j.Ub(14,"button",14),j.bc("click",function(){return j.vc(n),j.ec().onLoadDeviceInfoClick()}),j.fc(15,"async"),j.Hc(16,"Load device info"),j.Tb(),j.Tb(),j.Fc(17,Y,3,2,"div",15),j.Tb(),j.Tb()}if(2&e){var r=j.ec(),i=j.uc(10);j.Ab(2),j.mc("formGroup",r.form),j.Ab(4),j.mc("nzErrorTip",i),j.Ab(5),j.mc("nzErrorTip",i),j.Ab(3),j.mc("disabled",!r.form.valid)("nzLoading",j.gc(15,6,r.isDeviceInfoLoading$)),j.Ab(3),j.mc("ngIf",null!=r.deviceIsFound)}}var X=function(e){return{"test-measurement":e}};function K(e,t){if(1&e&&(j.Ub(0,"tr",23),j.Ub(1,"td"),j.Hc(2),j.fc(3,"date"),j.Tb(),j.Ub(4,"td"),j.Hc(5),j.Tb(),j.Ub(6,"td"),j.Hc(7),j.Tb(),j.Ub(8,"td"),j.Hc(9),j.Tb(),j.Ub(10,"td"),j.Hc(11),j.Tb(),j.Ub(12,"td"),j.Hc(13),j.Tb(),j.Ub(14,"td"),j.Hc(15),j.Tb(),j.Ub(16,"td"),j.Hc(17),j.Tb(),j.Ub(18,"td"),j.Hc(19),j.Tb(),j.Ub(20,"td"),j.Hc(21),j.Tb(),j.Tb()),2&e){var n=t.$implicit;j.mc("ngClass",j.pc(15,X,n.test))("title",n.test?"Test measurement":""),j.Ab(2),j.Ic(j.hc(3,12,n.measurement_date,"short")),j.Ab(3),j.Ic(n.systolic),j.Ab(2),j.Ic(n.diastolic),j.Ab(2),j.Ic(n.pulse),j.Ab(2),j.Ic(n.heartbeat_zone_frequency),j.Ab(2),j.Ic(n.valve_zone_frequency),j.Ab(2),j.Ic(n.cardiovascular_zone_frequency),j.Ab(2),j.Ic(n.weight),j.Ab(2),j.Ic(n.spo2),j.Ab(2),j.Ic(n.blood_glucose)}}function Q(e,t){1&e&&(j.Sb(0),j.Hc(1," This field is required "),j.Rb())}function B(e,t){if(1&e&&(j.Sb(0),j.Hc(1),j.Rb()),2&e){var n=j.ec().$implicit;j.Ab(1),j.Jc(" ",n.errors.validationError," ")}}function ee(e,t){if(1&e&&(j.Fc(0,Q,2,0,"ng-container",1),j.Fc(1,B,2,1,"ng-container",1)),2&e){var n=t.$implicit;j.mc("ngIf",n.hasError("required")),j.Ab(1),j.mc("ngIf",n.hasError("validationError"))}}var te,ne,re,ie=[{path:"",component:(te=function(t){n(o,t);var r=i(o);function o(e,t,n){var i;return a(this,o),(i=r.call(this)).testAndAssociateDeviceService=e,i.orderDetailsService=t,i.errorService=n,i.displayColumnsTypes=[{type:"blood_glucose",columns:[{name:"Measurement date"},{name:v.a.blood_glucose}]},{type:"scales",columns:[{name:"Measurement date"},{name:v.a.weight}]},{type:"pulse_oximeter",columns:[{name:"Measurement date"},{name:v.a.spo2}]},{type:"blood_pressure_monitor",columns:[{name:"Measurement date"},{name:"Systolic"},{name:"Diastolic"},{name:"Pulse"},{name:"I_1"},{name:"I_2"},{name:"I_3"}]}],i.displayColumns=[],i.isDeviceInfoLoading$=new p.a(!1),i.form=new b.h({pk:new b.e("",[b.s.required]),deviceSerialNumber:new b.e("",[b.s.required])}),i}return u(o,[{key:"getMeasurements",value:function(e){return this.getItems(this.testAndAssociateDeviceService.getMeasurements(e))}},{key:"onRefreshTableClick",value:function(){var e=this;this.isMeasurementsLoading=!0,this.getMeasurements(this.deviceInfo.id).pipe(Object(y.a)(this.destroyed),Object(I.a)(function(){return e.isMeasurementsLoading=!1})).subscribe()}},{key:"onLoadDeviceInfoClick",value:function(){var e=this;this.errorService.form=this.form,this.isDeviceInfoLoading$.next(!0),this.testAndAssociateDeviceService.getDeviceInfo(this.f.pk.value,this.f.deviceSerialNumber.value,this.orderDetailsService.orderInfo.device_type).pipe(Object(y.a)(this.destroyed),Object(O.a)(function(){return e.orderDetailsService.deviceIsFound$.next(null)}),Object(I.a)(function(){return e.isDeviceInfoLoading$.next(!1)}),Object(z.a)(function(t){return t?(e.orderDetailsService.deviceIsFound$.next(!0),e.deviceInfo=t,e.getMeasurements(e.deviceInfo.id)):(e.deviceInfo=null,e.orderDetailsService.deviceIsFound$.next(!1),g.a)})).subscribe(function(){},function(){return e.orderDetailsService.deviceIsFound$.next(!1)})}},{key:"associateDevice",value:function(){var e=this;return this.testAndAssociateDeviceService.openConfirmationModal().pipe(Object(O.a)(function(){return e.orderDetailsService.onConfirmation$.next(!0)}),Object(z.a)(function(){return e.testAndAssociateDeviceService.associateDevice(e.orderDetailsService.orderInfo.id,e.deviceInfo.id)}),Object(T.a)(function(){return e.orderDetailsService.orderInfo.device=e.deviceInfo}),Object(I.a)(function(){return e.orderDetailsService.onConfirmation$.next(!1)}))}},{key:"ngOnInit",value:function(){var t=this;this.isLoading$.next(!0),this.orderDetailsService.orderInfo$.pipe(Object(y.a)(this.destroyed),Object(C.a)(function(e){return!!e}),Object(z.a)(function(n){return t.displayColumns=e(t.displayColumnsTypes.find(function(e){return e.type===n.device_type}).columns),n.device?(t.deviceInfo=n.device,t.getMeasurements(n.device.id)):t.stopLoading()})).subscribe(),this.orderIsLoading$=this.orderDetailsService.orderIsLoading$.asObservable(),this.orderDetailsService.deviceIsFound$.pipe(Object(y.a)(this.destroyed)).subscribe(function(e){return t.deviceIsFound=e}),this.orderDetailsService.confirmEvt.pipe(Object(y.a)(this.destroyed),Object(z.a)(function(){return t.orderDetailsService.orderInfo.device?Object(h.a)(g.a):t.associateDevice()})).subscribe(function(){return t.orderDetailsService.goToNextStep()}),this.form.valueChanges.pipe(Object(y.a)(this.destroyed)).subscribe(function(){t.orderDetailsService.deviceIsFound$.next(null),t.deviceInfo=null,t.items=[]})}},{key:"hasDevice",get:function(){var e,t;return!!(null===(t=null===(e=this.orderDetailsService.orderInfo$.value)||void 0===e?void 0:e.device)||void 0===t?void 0:t.id)}},{key:"f",get:function(){return this.form.controls}}]),o}(m.a),te.\u0275fac=function(e){return new(e||te)(j.Ob(_),j.Ob(L.a),j.Ob(x.a))},te.\u0275cmp=j.Ib({type:te,selectors:[["app-test-and-associate-device"]],features:[j.xb],decls:11,vars:12,consts:[[1,"container"],[4,"ngIf"],["nzText","Test measurements","nzOrientation","left",1,"large"],["nz-button","","nzType","primary",1,"refresh-btn",3,"nzLoading","disabled","click"],["nz-icon","","nzType","reload","nzTheme","outline"],[3,"data","totalCount","nzShowPagination","isLoading$","allowQueryParams","displayColumns"],[3,"ngClass","title",4,"ngFor","ngForOf"],["errorTpl",""],["nzText","Device selection","nzOrientation","left",1,"large"],["nz-form","","nzLayout","inline",1,"load-device-form",3,"formGroup"],["nzRequired",""],[3,"nzErrorTip"],["formControlName","pk","nz-input",""],["formControlName","deviceSerialNumber","nz-input",""],["nz-button","","nzType","primary",3,"disabled","nzLoading","click"],["class","load-device-form__msg",4,"ngIf"],[1,"load-device-form__msg"],["nzColor","error",4,"ngIf"],["nzColor","success",4,"ngIf"],["nzColor","error"],["nz-icon","","nzType","close-circle"],["nzColor","success"],["nz-icon","","nzType","check-circle"],[3,"ngClass","title"]],template:function(e,t){1&e&&(j.Ub(0,"div",0),j.Fc(1,Z,18,8,"section",1),j.fc(2,"async"),j.Pb(3,"nz-divider",2),j.Ub(4,"button",3),j.bc("click",function(){return t.onRefreshTableClick()}),j.Pb(5,"i",4),j.Hc(6," Refresh table "),j.Tb(),j.Ub(7,"app-table-wrapper",5),j.Fc(8,K,22,17,"tr",6),j.Tb(),j.Tb(),j.Fc(9,ee,2,2,"ng-template",null,7,j.Gc)),2&e&&(j.Ab(1),j.mc("ngIf",!t.hasDevice&&!j.gc(2,10,t.orderIsLoading$)),j.Ab(3),j.mc("nzLoading",t.isMeasurementsLoading)("disabled",!t.deviceInfo),j.Ab(3),j.mc("data",t.items)("totalCount",null==t.items?null:t.items.length)("nzShowPagination",!1)("isLoading$",t.isLoading$.asObservable())("allowQueryParams",!1)("displayColumns",t.displayColumns),j.Ab(1),j.mc("ngForOf",t.items))},directives:[U.o,$.a,P.a,M.a,R.a,F.a,H.a,U.n,b.t,b.o,E.b,b.i,q.c,E.c,q.a,E.d,E.a,b.d,N.b,b.n,b.g,G.a,J.i,U.m,J.b],pipes:[U.b,U.e],styles:["[_nghost-%COMP%]     .ant-form-inline .ant-form-item-with-help{margin-bottom:0!important}.refresh-btn[_ngcontent-%COMP%]{margin-bottom:16px}.load-device-form__msg[_ngcontent-%COMP%]{display:flex;align-items:center;max-height:32px}"],changeDetection:0}),te)}],oe=((re=function e(){a(this,e)}).\u0275mod=j.Mb({type:re}),re.\u0275inj=j.Lb({factory:function(e){return new(e||re)},imports:[[d.h.forChild(ie)],d.h]}),re),ce=((ne=function e(){a(this,e)}).\u0275mod=j.Mb({type:ne}),ne.\u0275inj=j.Lb({factory:function(e){return new(e||ne)},imports:[[f.a,oe,w]]}),ne)},Pj3g:function(e,t,r){"use strict";r.d(t,"a",function(){return m});var o=r("fXoL"),c=r("oaey"),s=r("nYR2"),l=r("1G5W"),f=r("lJxs"),d=r("2Vo4"),b=r("EY2u"),m=function(e){n(r,e);var t=i(r);function r(){var e;return a(this,r),(e=t.call(this)).isLoading$=new d.a(!0),e.pageIndex$=new o.n,e.params=null,e}return u(r,[{key:"stopLoading",value:function(){return this.isLoading$.next(!1),b.a}},{key:"goToPrevPage",value:function(){return this.pageIndex$.emit(),b.a}},{key:"getItems",value:function(e){var t=this;return this.isLoading$.next(!0),e.pipe(Object(s.a)(function(){return t.isLoading$.next(!1)}),Object(l.a)(this.destroyed),Object(f.a)(function(e){return t.items=e.items,t.totalCount=e.total_count,e}))}}]),r}(c.a)},o5fV:function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r,i=n("mrSG"),o=n("sbGu"),c=n("dEAy"),s=n("CvgI"),l=n("tk/3"),f=n("lJxs"),d=n("pLZG"),b=n("fXoL"),m=((r=function e(t){a(this,e),this.modal=t,this.modal.updateConfig({nzWrapClassName:"vertical-center-modal",nzMaskClosable:!0,nzAutofocus:null,nzOkType:"danger",nzOkText:"Delete",nzClosable:!1})}).\u0275fac=function(e){return new(e||r)(b.Ob(c.c))},r.\u0275cmp=b.Ib({type:r,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},encapsulation:2,changeDetection:0}),r),v=function(){function e(){a(this,e);var t=o.a.getInjector;this.http=t.get(l.c),this.modalService=t.get(c.d)}return u(e,[{key:"getItems",value:function(e,t,n){var r=Object(s.a)(e),i=Object.assign({params:r},n);return this.http.get(t,Object.assign({},i)).pipe(Object(f.a)(function(e){return e}))}},{key:"openModal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;return this.modalService.create(Object.assign(Object.assign({},r&&{nzWrapClassName:"vertical-center-modal"}),{nzTitle:e,nzWidth:i+"px",nzContent:n,nzComponentParams:Object.assign({},t)})).afterClose.pipe(Object(d.a)(function(e){return e}))}},{key:"openActionConfirmationModal",value:function(e,t){return this.modalService.confirm({nzContent:t,nzTitle:e,nzOnOk:function(){return!0}}).afterClose.pipe(Object(d.a)(function(e){return e}))}},{key:"deleteItem",value:function(e,t){var n=this;return this.modalService.confirm({nzContent:m,nzTitle:e,nzOnOk:function(e){return Object(i.a)(n,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.modal.config.nzOkLoading=!0,n.next=3,this.deleteItemRequest(t);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}},n,this)}))}}).afterClose.pipe(Object(d.a)(function(e){return e}))}},{key:"deleteItemRequest",value:function(e){return Object(i.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.http.delete(e).toPromise().then(function(e){return"success"===e.status});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}}]),e}()}}])}();