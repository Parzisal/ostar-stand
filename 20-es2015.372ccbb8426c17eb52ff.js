(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{COhe:function(e,t,n){"use strict";n.r(t),n.d(t,"TestAndAssociateDeviceModule",function(){return Z});var i=n("PCNd"),s=n("tyNb"),o=n("3Pt+"),r=n("Pj3g"),c=n("xlym"),a=n("2Vo4"),d=n("EY2u"),l=n("LRne"),u=n("1G5W"),b=n("nYR2"),m=n("vkgz"),f=n("eIep"),p=n("lJxs"),v=n("pLZG"),h=n("fXoL"),g=n("ILvI"),I=n("o5fV"),z=n("dEAy");let y=(()=>{class e{constructor(e){this.modal=e,this.modal.updateConfig({nzWrapClassName:"vertical-center-modal",nzMaskClosable:!0,nzAutofocus:null,nzOkType:"primary",nzOkText:"Assign",nzClosable:!1})}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(h.Ob(z.c))},e.\u0275cmp=h.Ib({type:e,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},styles:[""],changeDetection:0}),e})(),O=(()=>{class e{}return e.\u0275mod=h.Mb({type:e}),e.\u0275inj=h.Lb({factory:function(t){return new(t||e)}}),e})(),T=(()=>{class e extends I.a{constructor(){super()}getMeasurements(e){return this.getItems({order_by:null,limit:10,offset:0,devices:e},g.q).pipe(Object(p.a)(e=>e))}getDeviceInfo(e,t,n){return this.getItems({device_id:e,device_type:n,serial_number:t,assigned_to_patient:!1},g.f,{skipInterceptor:!0}).pipe(Object(p.a)(e=>e.items[0]))}associateDevice(e,t){return this.http.put(Object(g.u)(e),{device:t})}openConfirmationModal(){return this.openActionConfirmationModal("Are you sure to assign selected device to this order? This action could not be reverted.",y)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=h.Kb({token:e,factory:e.\u0275fac,providedIn:O}),e})();var C=n("LEIr"),D=n("lhsU"),A=n("ofXK"),j=n("5vDB"),L=n("OzZK"),S=n("RwU8"),x=n("C2AL"),_=n("FwiY"),U=n("1ReC"),$=n("ocnv"),w=n("B+r4"),M=n("PTRe"),k=n("ZyQt"),P=n("rMZv");function F(e,t){1&e&&(h.Ub(0,"nz-tag",19),h.Pb(1,"i",20),h.Ub(2,"span"),h.Hc(3,"Device not found"),h.Tb(),h.Tb())}function H(e,t){1&e&&(h.Ub(0,"nz-tag",21),h.Pb(1,"i",22),h.Ub(2,"span"),h.Hc(3,"Device found"),h.Tb(),h.Tb())}function R(e,t){if(1&e&&(h.Ub(0,"div",16),h.Fc(1,F,4,0,"nz-tag",17),h.Fc(2,H,4,0,"nz-tag",18),h.Tb()),2&e){const e=h.ec(2);h.Ab(1),h.mc("ngIf",!e.deviceIsFound),h.Ab(1),h.mc("ngIf",e.deviceIsFound)}}function E(e,t){if(1&e){const e=h.Vb();h.Ub(0,"section"),h.Pb(1,"nz-divider",8),h.Ub(2,"form",9),h.Ub(3,"nz-form-item"),h.Ub(4,"nz-form-label",10),h.Hc(5,"Device ID"),h.Tb(),h.Ub(6,"nz-form-control",11),h.Pb(7,"input",12),h.Tb(),h.Tb(),h.Ub(8,"nz-form-item"),h.Ub(9,"nz-form-label",10),h.Hc(10,"Device serial number"),h.Tb(),h.Ub(11,"nz-form-control",11),h.Pb(12,"input",13),h.Tb(),h.Tb(),h.Ub(13,"nz-form-item"),h.Ub(14,"button",14),h.bc("click",function(){return h.vc(e),h.ec().onLoadDeviceInfoClick()}),h.fc(15,"async"),h.Hc(16,"Load device info"),h.Tb(),h.Tb(),h.Fc(17,R,3,2,"div",15),h.Tb(),h.Tb()}if(2&e){const e=h.ec(),t=h.uc(10);h.Ab(2),h.mc("formGroup",e.form),h.Ab(4),h.mc("nzErrorTip",t),h.Ab(5),h.mc("nzErrorTip",t),h.Ab(3),h.mc("disabled",!e.form.valid)("nzLoading",h.gc(15,6,e.isDeviceInfoLoading$)),h.Ab(3),h.mc("ngIf",null!=e.deviceIsFound)}}const q=function(e){return{"test-measurement":e}};function N(e,t){if(1&e&&(h.Ub(0,"tr",23),h.Ub(1,"td"),h.Hc(2),h.fc(3,"date"),h.Tb(),h.Ub(4,"td"),h.Hc(5),h.Tb(),h.Ub(6,"td"),h.Hc(7),h.Tb(),h.Ub(8,"td"),h.Hc(9),h.Tb(),h.Ub(10,"td"),h.Hc(11),h.Tb(),h.Ub(12,"td"),h.Hc(13),h.Tb(),h.Ub(14,"td"),h.Hc(15),h.Tb(),h.Ub(16,"td"),h.Hc(17),h.Tb(),h.Ub(18,"td"),h.Hc(19),h.Tb(),h.Ub(20,"td"),h.Hc(21),h.Tb(),h.Tb()),2&e){const e=t.$implicit;h.mc("ngClass",h.pc(15,q,e.test))("title",e.test?"Test measurement":""),h.Ab(2),h.Ic(h.hc(3,12,e.measurement_date,"short")),h.Ab(3),h.Ic(e.systolic),h.Ab(2),h.Ic(e.diastolic),h.Ab(2),h.Ic(e.pulse),h.Ab(2),h.Ic(e.heartbeat_zone_frequency),h.Ab(2),h.Ic(e.valve_zone_frequency),h.Ab(2),h.Ic(e.cardiovascular_zone_frequency),h.Ab(2),h.Ic(e.weight),h.Ab(2),h.Ic(e.spo2),h.Ab(2),h.Ic(e.blood_glucose)}}function G(e,t){1&e&&(h.Sb(0),h.Hc(1," This field is required "),h.Rb())}function J(e,t){if(1&e&&(h.Sb(0),h.Hc(1),h.Rb()),2&e){const e=h.ec().$implicit;h.Ab(1),h.Jc(" ",e.errors.validationError," ")}}function W(e,t){if(1&e&&(h.Fc(0,G,2,0,"ng-container",1),h.Fc(1,J,2,1,"ng-container",1)),2&e){const e=t.$implicit;h.mc("ngIf",e.hasError("required")),h.Ab(1),h.mc("ngIf",e.hasError("validationError"))}}const V=[{path:"",component:(()=>{class e extends r.a{constructor(e,t,n){super(),this.testAndAssociateDeviceService=e,this.orderDetailsService=t,this.errorService=n,this.displayColumnsTypes=[{type:"blood_glucose",columns:[{name:"Measurement date"},{name:c.a.blood_glucose}]},{type:"scales",columns:[{name:"Measurement date"},{name:c.a.weight}]},{type:"pulse_oximeter",columns:[{name:"Measurement date"},{name:c.a.spo2}]},{type:"blood_pressure_monitor",columns:[{name:"Measurement date"},{name:"Systolic"},{name:"Diastolic"},{name:"Pulse"},{name:"I_1"},{name:"I_2"},{name:"I_3"}]}],this.displayColumns=[],this.isDeviceInfoLoading$=new a.a(!1),this.form=new o.h({pk:new o.e("",[o.s.required]),deviceSerialNumber:new o.e("",[o.s.required])})}get hasDevice(){var e,t;return!!(null===(t=null===(e=this.orderDetailsService.orderInfo$.value)||void 0===e?void 0:e.device)||void 0===t?void 0:t.id)}get f(){return this.form.controls}getMeasurements(e){return this.getItems(this.testAndAssociateDeviceService.getMeasurements(e))}onRefreshTableClick(){this.isMeasurementsLoading=!0,this.getMeasurements(this.deviceInfo.id).pipe(Object(u.a)(this.destroyed),Object(b.a)(()=>this.isMeasurementsLoading=!1)).subscribe()}onLoadDeviceInfoClick(){this.errorService.form=this.form,this.isDeviceInfoLoading$.next(!0),this.testAndAssociateDeviceService.getDeviceInfo(this.f.pk.value,this.f.deviceSerialNumber.value,this.orderDetailsService.orderInfo.device_type).pipe(Object(u.a)(this.destroyed),Object(m.a)(()=>this.orderDetailsService.deviceIsFound$.next(null)),Object(b.a)(()=>this.isDeviceInfoLoading$.next(!1)),Object(f.a)(e=>e?(this.orderDetailsService.deviceIsFound$.next(!0),this.deviceInfo=e,this.getMeasurements(this.deviceInfo.id)):(this.deviceInfo=null,this.orderDetailsService.deviceIsFound$.next(!1),d.a))).subscribe(()=>{},()=>this.orderDetailsService.deviceIsFound$.next(!1))}associateDevice(){return this.testAndAssociateDeviceService.openConfirmationModal().pipe(Object(m.a)(()=>this.orderDetailsService.onConfirmation$.next(!0)),Object(f.a)(()=>this.testAndAssociateDeviceService.associateDevice(this.orderDetailsService.orderInfo.id,this.deviceInfo.id)),Object(p.a)(()=>this.orderDetailsService.orderInfo.device=this.deviceInfo),Object(b.a)(()=>this.orderDetailsService.onConfirmation$.next(!1)))}ngOnInit(){this.isLoading$.next(!0),this.orderDetailsService.orderInfo$.pipe(Object(u.a)(this.destroyed),Object(v.a)(e=>!!e),Object(f.a)(e=>(this.displayColumns=[...this.displayColumnsTypes.find(t=>t.type===e.device_type).columns],e.device?(this.deviceInfo=e.device,this.getMeasurements(e.device.id)):this.stopLoading()))).subscribe(),this.orderIsLoading$=this.orderDetailsService.orderIsLoading$.asObservable(),this.orderDetailsService.deviceIsFound$.pipe(Object(u.a)(this.destroyed)).subscribe(e=>this.deviceIsFound=e),this.orderDetailsService.confirmEvt.pipe(Object(u.a)(this.destroyed),Object(f.a)(()=>this.orderDetailsService.orderInfo.device?Object(l.a)(d.a):this.associateDevice())).subscribe(()=>this.orderDetailsService.goToNextStep()),this.form.valueChanges.pipe(Object(u.a)(this.destroyed)).subscribe(()=>{this.orderDetailsService.deviceIsFound$.next(null),this.deviceInfo=null,this.items=[]})}}return e.\u0275fac=function(t){return new(t||e)(h.Ob(T),h.Ob(C.a),h.Ob(D.a))},e.\u0275cmp=h.Ib({type:e,selectors:[["app-test-and-associate-device"]],features:[h.xb],decls:11,vars:12,consts:[[1,"container"],[4,"ngIf"],["nzText","Test measurements","nzOrientation","left",1,"large"],["nz-button","","nzType","primary",1,"refresh-btn",3,"nzLoading","disabled","click"],["nz-icon","","nzType","reload","nzTheme","outline"],[3,"data","totalCount","nzShowPagination","isLoading$","allowQueryParams","displayColumns"],[3,"ngClass","title",4,"ngFor","ngForOf"],["errorTpl",""],["nzText","Device selection","nzOrientation","left",1,"large"],["nz-form","","nzLayout","inline",1,"load-device-form",3,"formGroup"],["nzRequired",""],[3,"nzErrorTip"],["formControlName","pk","nz-input",""],["formControlName","deviceSerialNumber","nz-input",""],["nz-button","","nzType","primary",3,"disabled","nzLoading","click"],["class","load-device-form__msg",4,"ngIf"],[1,"load-device-form__msg"],["nzColor","error",4,"ngIf"],["nzColor","success",4,"ngIf"],["nzColor","error"],["nz-icon","","nzType","close-circle"],["nzColor","success"],["nz-icon","","nzType","check-circle"],[3,"ngClass","title"]],template:function(e,t){1&e&&(h.Ub(0,"div",0),h.Fc(1,E,18,8,"section",1),h.fc(2,"async"),h.Pb(3,"nz-divider",2),h.Ub(4,"button",3),h.bc("click",function(){return t.onRefreshTableClick()}),h.Pb(5,"i",4),h.Hc(6," Refresh table "),h.Tb(),h.Ub(7,"app-table-wrapper",5),h.Fc(8,N,22,17,"tr",6),h.Tb(),h.Tb(),h.Fc(9,W,2,2,"ng-template",null,7,h.Gc)),2&e&&(h.Ab(1),h.mc("ngIf",!t.hasDevice&&!h.gc(2,10,t.orderIsLoading$)),h.Ab(3),h.mc("nzLoading",t.isMeasurementsLoading)("disabled",!t.deviceInfo),h.Ab(3),h.mc("data",t.items)("totalCount",null==t.items?null:t.items.length)("nzShowPagination",!1)("isLoading$",t.isLoading$.asObservable())("allowQueryParams",!1)("displayColumns",t.displayColumns),h.Ab(1),h.mc("ngForOf",t.items))},directives:[A.o,j.a,L.a,S.a,x.a,_.a,U.a,A.n,o.t,o.o,$.b,o.i,w.c,$.c,w.a,$.d,$.a,o.d,M.b,o.n,o.g,k.a,P.i,A.m,P.b],pipes:[A.b,A.e],styles:["[_nghost-%COMP%]     .ant-form-inline .ant-form-item-with-help{margin-bottom:0!important}.refresh-btn[_ngcontent-%COMP%]{margin-bottom:16px}.load-device-form__msg[_ngcontent-%COMP%]{display:flex;align-items:center;max-height:32px}"],changeDetection:0}),e})()}];let Y=(()=>{class e{}return e.\u0275mod=h.Mb({type:e}),e.\u0275inj=h.Lb({factory:function(t){return new(t||e)},imports:[[s.h.forChild(V)],s.h]}),e})(),Z=(()=>{class e{}return e.\u0275mod=h.Mb({type:e}),e.\u0275inj=h.Lb({factory:function(t){return new(t||e)},imports:[[i.a,Y,O]]}),e})()},Pj3g:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n("fXoL"),s=n("oaey"),o=n("nYR2"),r=n("1G5W"),c=n("lJxs"),a=n("2Vo4"),d=n("EY2u");class l extends s.a{constructor(){super(),this.isLoading$=new a.a(!0),this.pageIndex$=new i.n,this.params=null}stopLoading(){return this.isLoading$.next(!1),d.a}goToPrevPage(){return this.pageIndex$.emit(),d.a}getItems(e){return this.isLoading$.next(!0),e.pipe(Object(o.a)(()=>this.isLoading$.next(!1)),Object(r.a)(this.destroyed),Object(c.a)(e=>(this.items=e.items,this.totalCount=e.total_count,e)))}}},o5fV:function(e,t,n){"use strict";n.d(t,"a",function(){return b});var i=n("mrSG"),s=n("sbGu"),o=n("dEAy"),r=n("CvgI"),c=n("tk/3"),a=n("lJxs"),d=n("pLZG"),l=n("fXoL");let u=(()=>{class e{constructor(e){this.modal=e,this.modal.updateConfig({nzWrapClassName:"vertical-center-modal",nzMaskClosable:!0,nzAutofocus:null,nzOkType:"danger",nzOkText:"Delete",nzClosable:!1})}}return e.\u0275fac=function(t){return new(t||e)(l.Ob(o.c))},e.\u0275cmp=l.Ib({type:e,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},encapsulation:2,changeDetection:0}),e})();class b{constructor(){const e=s.a.getInjector;this.http=e.get(c.c),this.modalService=e.get(o.d)}getItems(e,t,n){const i=Object(r.a)(e),s=Object.assign({params:i},n);return this.http.get(t,Object.assign({},s)).pipe(Object(a.a)(e=>e))}openModal(e,t=null,n,i=!0,s=600){return this.modalService.create(Object.assign(Object.assign({},i&&{nzWrapClassName:"vertical-center-modal"}),{nzTitle:e,nzWidth:s+"px",nzContent:n,nzComponentParams:Object.assign({},t)})).afterClose.pipe(Object(d.a)(e=>e))}openActionConfirmationModal(e,t){return this.modalService.confirm({nzContent:t,nzTitle:e,nzOnOk:()=>!0}).afterClose.pipe(Object(d.a)(e=>e))}deleteItem(e,t){return this.modalService.confirm({nzContent:u,nzTitle:e,nzOnOk:e=>Object(i.a)(this,void 0,void 0,function*(){return e.modal.config.nzOkLoading=!0,yield this.deleteItemRequest(t)})}).afterClose.pipe(Object(d.a)(e=>e))}deleteItemRequest(e){return Object(i.a)(this,void 0,void 0,function*(){return yield this.http.delete(e).toPromise().then(e=>"success"===e.status)})}}}}]);